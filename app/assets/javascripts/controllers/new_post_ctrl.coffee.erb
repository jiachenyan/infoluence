
angular.module('Infoluence').controller 'NewPostController', [

 'CookieService'
 'UUID'
 'PostService'
 'FeedFactory'

 '$scope'
 '$stateParams'


 (CookieService,UUID,PostService,FeedFactory,$scope,$stateParams) ->

  $scope.me = null

  #post content is an array of object with different types
  $scope.content = []

  $scope.initNewPost = =>
   pg = 
    type:"pg"
    body:""
   $scope.content.push pg


  $scope.submitPost = =>
   console.log "submitting"
   params =
    content:        
     title: $scope.title
     data:  $scope.content

   console.log params

   PostService.submitPost(params).then (res) =>
    console.log res.data
    FeedFactory.feed.unshift res.data
    # FeedFactory.pushNewPost(res.data.postId)
    # $scope.previewing = false
    # #$scope.refresh()

    # $scope.submitting = false

    # PostService.getDetailPost(res.data.rootId).then (res) =>
    #  if res.data.status == 'open' || res.data.status == 'pending_open'
    #   MyHoldingFactory.addToHoldings(res.data)
    #  if res.data.status == 'closed' || res.data.status == 'pending_close'
    #   MyHoldingFactory.removeFromHoldings(res.data)

]
