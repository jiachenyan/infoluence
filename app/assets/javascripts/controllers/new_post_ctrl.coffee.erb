
angular.module('Infoluence').controller 'NewPostController', [

 'CookieService'
 'UUID'
 'PostService'
 'FeedFactory'

 '$scope'
 '$stateParams'


 (CookieService,UUID,PostService,FeedFactory,$scope,$stateParams) ->

  $scope.me = null

  #post content is an array of object with different types
  $scope.content = []

  $scope.linkUrl = ""
  $scope.previousLinkUrl = ""

  $scope.initNewPost = =>
   pg = 
    type:"pg"
    body:""
   $scope.content.push pg

  $scope.initializeLinkLoading = =>
   




  $scope.submitPost = =>

   console.log "submitting"

   params =
    content:        
     title: $scope.title
     data:  $scope.content

   console.log params

   PostService.submitPost(params).then (res) =>
    console.log res.data
    FeedFactory.feed.unshift res.data

  $scope.$watch "linkUrl", =>
   if ($scope.linkUrl.length - $scope.previousLinkUrl.length) > 5
    $scope.initializeLinkLoading



]
